var F=Object.defineProperty,k=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var $=(e,n)=>(n=Symbol[e])?n:Symbol.for("Symbol."+e);var C=(e,n,t)=>n in e?F(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,y=(e,n)=>{for(var t in n||(n={}))N.call(n,t)&&C(e,t,n[t]);if(L)for(var t of L(n))R.call(n,t)&&C(e,t,n[t]);return e},D=(e,n)=>k(e,K(n));var x=(e,n,t)=>new Promise((s,i)=>{var c=r=>{try{a(t.next(r))}catch(u){i(u)}},o=r=>{try{a(t.throw(r))}catch(u){i(u)}},a=r=>r.done?s(r.value):Promise.resolve(r.value).then(c,o);a((t=t.apply(e,n)).next())}),h=function(e,n){this[0]=e,this[1]=n},S=(e,n,t)=>{var s=(o,a,r,u)=>{try{var P=t[o](a),g=(a=P.value)instanceof h,p=P.done;Promise.resolve(g?a[0]:a).then(d=>g?s(o==="return"?o:"next",a[1]?{done:d.done,value:d.value}:d,r,u):r({value:d,done:p})).catch(d=>s("throw",d,r,u))}catch(d){u(d)}},i=o=>c[o]=a=>new Promise((r,u)=>s(o,a,r,u)),c={};return t=t.apply(e,n),c[$("asyncIterator")]=()=>c,i("next"),i("throw"),i("return"),c};const w=(e,n)=>n.some(t=>e instanceof t);let T,V;function z(){return T||(T=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function G(){return V||(V=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const B=new WeakMap,l=new WeakMap,I=new WeakMap;function H(e){const n=new Promise((t,s)=>{const i=()=>{e.removeEventListener("success",c),e.removeEventListener("error",o)},c=()=>{t(f(e.result)),i()},o=()=>{s(e.error),i()};e.addEventListener("success",c),e.addEventListener("error",o)});return I.set(n,e),n}function J(e){if(B.has(e))return;const n=new Promise((t,s)=>{const i=()=>{e.removeEventListener("complete",c),e.removeEventListener("error",o),e.removeEventListener("abort",o)},c=()=>{t(),i()},o=()=>{s(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",c),e.addEventListener("error",o),e.addEventListener("abort",o)});B.set(e,n)}let b={get(e,n,t){if(e instanceof IDBTransaction){if(n==="done")return B.get(e);if(n==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return f(e[n])},set(e,n,t){return e[n]=t,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function v(e){b=e(b)}function Q(e){return G().includes(e)?function(...n){return e.apply(E(this),n),f(this.request)}:function(...n){return f(e.apply(E(this),n))}}function U(e){return typeof e=="function"?Q(e):(e instanceof IDBTransaction&&J(e),w(e,z())?new Proxy(e,b):e)}function f(e){if(e instanceof IDBRequest)return H(e);if(l.has(e))return l.get(e);const n=U(e);return n!==e&&(l.set(e,n),I.set(n,e)),n}const E=e=>I.get(e);function ne(e,n,{blocked:t,upgrade:s,blocking:i,terminated:c}={}){const o=indexedDB.open(e,n),a=f(o);return s&&o.addEventListener("upgradeneeded",r=>{s(f(o.result),r.oldVersion,r.newVersion,f(o.transaction),r)}),t&&o.addEventListener("blocked",r=>t(r.oldVersion,r.newVersion,r)),a.then(r=>{c&&r.addEventListener("close",()=>c()),i&&r.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const X=["get","getKey","getAll","getAllKeys","count"],Y=["put","add","delete","clear"],m=new Map;function j(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(m.get(n))return m.get(n);const t=n.replace(/FromIndex$/,""),s=n!==t,i=Y.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||X.includes(t)))return;const c=function(o,...a){return x(this,null,function*(){const r=this.transaction(o,i?"readwrite":"readonly");let u=r.store;return s&&(u=u.index(a.shift())),(yield Promise.all([u[t](...a),i&&r.done]))[0]})};return m.set(n,c),c}v(e=>D(y({},e),{get:(n,t,s)=>j(n,t)||e.get(n,t,s),has:(n,t)=>!!j(n,t)||e.has(n,t)}));const Z=["continue","continuePrimaryKey","advance"],A={},M=new WeakMap,W=new WeakMap,_={get(e,n){if(!Z.includes(n))return e[n];let t=A[n];return t||(t=A[n]=function(...s){M.set(this,W.get(this)[n](...s))}),t}};function q(...e){return S(this,null,function*(){let n=this;if(n instanceof IDBCursor||(n=yield new h(n.openCursor(...e))),!n)return;n=n;const t=new Proxy(n,_);for(W.set(t,n),I.set(t,E(n));n;)yield t,n=yield new h(M.get(t)||n.continue()),M.delete(t)})}function O(e,n){return n===Symbol.asyncIterator&&w(e,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&w(e,[IDBIndex,IDBObjectStore])}v(e=>D(y({},e),{get(n,t,s){return O(n,t)?q:e.get(n,t,s)},has(n,t){return O(n,t)||e.has(n,t)}}));export{ne as o};
